{% block content %}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
<body onload="onLoad()">    
    <div onmousedown="onClick(event)" onmousemove="onMouseHover(event)">
    <div id='toolTipBox' style="z-index:2001;" class="toolTip"></div>
    <span id="status"></span>
    <button id="Sat." onclick="showSat()" class="buttonMapSat" style="z-index:1998; top:10px;"> Sat.</button>
    <button id="Map."  onclick="hideSat()" class="buttonMapSat" style="z-index:1998; top:70px;"> Map</button>
    <fieldset id="menuMinMap" style="z-index:1998" class="menuMinMap">
        <h1>Temporary Dev Menu</h1>
        <button onclick="satLayer.setVisible(true)" class="buttonMap">Satellite</button> 
        <button onclick="satLayer.setVisible(false)" class="buttonMap">Map</button><br>
        <input type="checkbox" id="streets" name="Streets" value="Bike">
        <label for="Streets"> Street overlay</label><br>
        <input type="checkbox" id="terrain" name="Terrain" value="Car">
        <label for="Terrian"> Terrain overlay</label><br>
        <label for="track">track position<input id="track" type="checkbox"/></label>
        <form class="form-inline">
        <label for="type">Geometry type: &nbsp;</label>
        <select class="form-control mr-2 mb-2 mt-2" id="type">
            <option value="None">None</option>
            <option value="Point">Point</option>
            <option value="LineString">Line</option>
            <option value="Polygon">Polygon</option>
            <option value="Circle">Circle</option>
        </select>
        <input class="form-control mr-2 mb-2 mt-2" type="button" value="Undo" id="undo">
        </form>
    </fieldset>
    <div class="menuMainSet" id="menuMainSet" style="z-index:3001">
        <button class="circleMenuCenter" id="cMenuMain" onclick="hideMenuMain()" style="z-index:3001">X</button>
        <button class="circleMenuOuter" id="cMenuN" style="z-index:3001">Assign</button>
        <button class="circleMenuOuter" id="cMenuNE"  onclick="openMenuFeature()"style="z-index:3001">Features</button>
        <button class="circleMenuOuter" id="cMenuE" onclick="openMenuSegment()" style="z-index:3001">Segment</button>
        <button class="circleMenuOuter" id="cMenuSE"  style="z-index:3001">Spare</button>
        <button class="circleMenuOuter" id="cMenuS"  style="z-index:3001">Options</button>
        <button class="circleMenuOuter" id="cMenuSW" onclick="openMenuLayers()" style="z-index:3001" >Layers</button>
        <button class="circleMenuOuter" id="cMenuW"  style="z-index:3001">Profile</button>
        <button class="circleMenuOuter" id="cMenuNW"  style="z-index:3001">Draw</button>
    </div>
    <div class="menuLayersSet" id="menuLayerSet" style="z-index:3001">
        <button class="circleMenuCenter" id="lMenuMain"  onclick= "layerMenuBack()" style="z-index:3001; font-size:35px">Back</button>
        <button class="circleMenuOuter" id="lMenuN" onclick= "toggleStreets()" style="z-index:3001">Streets</button>
        <button class="circleMenuOuter" id="lMenuNE" onclick= "toggleTerrain()"  style="z-index:3001">Terrain</button>
        <button class="circleMenuEmpty" id="lMenuE"  style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="lMenuSE"  style="z-index:3001"></button>
        <button class="circleMenuOuter" id="lMenuS" onclick= " hideLayerMenu()"  style="z-index:3001">X</button>
        <button class="circleMenuEmpty" id="lMenuSW" style="z-index:3001" ></button>
        <button class="circleMenuEmpty" id="lMenuW"  style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="lMenuNW"  style="z-index:3001"></button>
    </div>
    <div class="menuSegmentSet" id="menuSegmentSet" style="z-index:3001">
        <button class="circleMenuCenter" id="sMenuMain"  onclick= "segmentMenuBack()" style="z-index:3001; font-size:35px">Back</button>
        <button class="circleMenuOuter" id="sMenuNW"  style="z-index:3001">Auto-Segment</button>
        <button class="circleMenuOuter" id="sMenuN" onclick="drawSegment()"  style="z-index:3001">Draw Segment</button>
        <button class="circleMenuOuter" id="sMenuNE" onclick="editSegment()" style="z-index:3001">Edit Segment</button>
        <button class="circleMenuEmpty" id="sMenuSE"  style="z-index:3001"></button>
        <button class="circleMenuOuter" id="sMenuS" onclick= " hideSegmentMenu()"  style="z-index:3001">X</button>
        <button class="circleMenuEmpty" id="sMenuSW" style="z-index:3001" ></button>
        <button class="circleMenuEmpty" id="sMenuW"  style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="sMenuE"  style="z-index:3001"></button>
    </div>
    <div class="menuFeatureSet" id="menuFeatureSet" style="z-index:3001">
        <button class="circleMenuCenter" id="fMenuMain"  onclick= "featureMenuBack()" style="z-index:3001; font-size:35px">Back</button>
        <button class="circleMenuOuter" id="fMenuN" onclick="addMarker()" style="z-index:3001">Place Feature</button>
        <button class="circleMenuEmpty" id="fMenuNE"  style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="fMenuE"style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="fMenuSE"  style="z-index:3001"></button>
        <button class="circleMenuOuter" id="fMenuS" onclick= " hideFeatureMenu()"  style="z-index:3001">X</button>
        <button class="circleMenuEmpty" id="fMenuSW" style="z-index:3001" ></button>
        <button class="circleMenuEmpty" id="fMenuW"  style="z-index:3001"></button>
        <button class="circleMenuEmpty" id="fMenuNW"  style="z-index:3001"></button>
    </div>
    <div class= "segmentEditMenu" id= "segmentEditMenu" style="z-index:3002">
        <label for="segName">Segment Name</label>
        <input type="text" id="segName" name="segName"><br><br>
        <button id="redSel"class="colorSelectRed" onclick="updateSegCol('red')"></button> 
        <button id="yellowSel" class="colorSelectYellow" onclick="updateSegCol('yellow')"></button> 
        <button id="greenSel" class="colorSelectGreen" onclick="updateSegCol('green')"></button> <br><br>
        <button id="modify" onclick="editSegment()">modify</button> 
        <button id="delete" onclick="deleteSeg()">delete</button> <br><br>
        <button id="close" onclick= "hideSegmentEditMenu()">close</button>
    </div>
    <div class= "segmentEditMenu" id= "markerEditMenu" style="z-index:3002">
        <label for="markerName">Feature Name</label>
        <input type="text" id="markerName" name="markerName"><br><br>
        <select name="Resource" id="Resource">
            <option value="structure">Structure</option>
            <option value="road">Road</option>
            <option value="linear">Linear Feature</option>
            <option value="drain">Drainage</option>
            <option value="water">Water</option>
            <option value="brush">Brush</option>
            <option value="scrub">Scrub</option>
            <option value="woods">Woods</option>
            <option value="field">Field</option>
            <option value="rock">Rock</option>
        </select> <br><br>
        <button id="delete" onclick="deleteMarker()">delete</button> <br><br>
        <button id="close" onclick= "hideMarkerEditMenu()">close</button>
    </div>        
    {% comment %} <label for="trackerID">TrackerID</label>
    <input type="text" id="trackerID" name="trackerID"><br><br>
    <input type="Button" id="trackerButton" onclick = "track()" name="trackerButton" value="Show Track"></input>  {% endcomment %}
</body>

<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
    <div id="map" width=window.innerWidth height=window.innerHeight class="map" style="z-index:1"></div>
    <span id="status"></span>   
    <script type="text/javascript">
        var mouseState = 0;
        // mouse states: 0 - default 1 - drawing 2 - gemoetry edit 3 - marker maker
        var key = 'pk.eyJ1IjoibWFycWkiLCJhIjoiY2tsN2U3eDhrMDU0YzMxcHNzYm96Z2VsdyJ9.ttzqAmH0t8YNXZAvzEmTxA';   
        var source = new ol.source.Vector({wrapX: false});

        var vector = new ol.layer.Vector({source: source,zIndex: 50,format: new ol.format.GeoJSON(),});
        var view = new ol.View({
            center: ol.proj.fromLonLat([-0.2704562,51.504194999999996]),
            zoom: 15
        });
        var geolocation = new ol.Geolocation({
        // enableHighAccuracy must be set to true to have the heading value.
            trackingOptions: {
                enableHighAccuracy: true,
            },
            projection: view.getProjection(),
        });
        function el(id) {
            return document.getElementById(id);
        }
        el('track').addEventListener('change', function () {
            geolocation.setTracking(this.checked);
        });

        var positionFeature = new ol.Feature();
        positionFeature.setStyle(
            new ol.style.Style({
                image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({
                    color: '#3399CC',
                }),
                stroke: new ol.style.Stroke({
                    color: '#fff',
                    width: 2,
                }),
                }),
            })
        );
        geolocation.on('change:position', function () {
            var coordinates = geolocation.getPosition();
            console.log(coordinates);
            positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);
        });
        var map = new ol.Map({
            target: 'map',
            layers: [
            vector,
            new ol.layer.Tile({source: new ol.source.OSM({ features: [positionFeature]}),zIndex: 1, className: 'mapp'})
            ],
            view: view,
        });
        var satLayer = new ol.layer.Tile({source: new ol.source.XYZ({url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',maxZoom: 19}),zIndex: 2, className: 'sat'});
        map.addLayer(satLayer);
        var streetsL = new ol.layer.VectorTile({
            declutter: true,
            zIndex: 51,
            name: 'streetsL',
            opacity: 1,
            source: new ol.source.VectorTile({
                attributions:
                '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> ' +
                '© <a href="https://www.openstreetmap.org/copyright">' +
                'OpenStreetMap contributors</a>',
                format: new ol.format.MVT(),
                url:
                'https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v8/' +
                '{z}/{x}/{y}.vector.pbf?access_token=' +
                key,
            })
            });
        map.addLayer(streetsL);

        var terrainL = new ol.layer.MapboxVector({
            declutter: true,
            zIndex: 51,
            className: 'terrainL',
            opacity: 1,
            styleUrl:'mapbox://styles/marqi/cklhwqmyl0zn517o1llp1rdrj',
            accessToken: key,
            })
        
        map.addLayer(terrainL);

        function vectorLayerListener() {
        var streetSelect = document.getElementById('streets').checked;
        var terrainSelect = document.getElementById('terrain').checked;
        if (streetSelect == false) {
            streetsL.setVisible(false);
        }
        if (streetSelect !== false) {
            streetsL.setVisible(true);
        }
        if (terrainSelect == false) {
            terrainL.setVisible(false);
        }
        if (terrainSelect !== false) {
            terrainL.setVisible(true);
        }
        }

        document.getElementById('streets').onchange = function () {
            vectorLayerListener();
        }
        document.getElementById('terrain').onchange = function () {
            vectorLayerListener();
        }
        function toggleStreets(){
            if (document.getElementById("streets").checked ==true){
                document.getElementById("streets").checked =false;
                document.getElementById("lMenuN").classList.remove("circleMenuOuterActive");
            } else{
                document.getElementById("streets").checked =true;
                document.getElementById("lMenuN").classList.add("circleMenuOuterActive");
                console.log('yo');
            }
            console.log('yo');
            vectorLayerListener() ;   
        }
        function toggleTerrain(){
            if (document.getElementById("terrain").checked ==true){
                document.getElementById("terrain").checked =false;
                document.getElementById("lMenuNE").classList.remove("circleMenuOuterActive");
            } else{
                document.getElementById("terrain").checked=true;
                document.getElementById("lMenuNE").classList.add("circleMenuOuterActive");
            }
            console.log('yo');
            vectorLayerListener() ;  
        }

        //////////////// sample draw code
        var typeSelect = document.getElementById('type');
        var draw; // global so we can remove it later
        function addInteraction() {
        var typeSelect = document.getElementById('type');
        var value = typeSelect.value;
        if (value !== 'None') {
            draw = new ol.interaction.Draw({
            source: source,
            type: typeSelect.value,
            });
            map.addInteraction(draw);
            };
        };

        /**
        * Handle change event.
        */
        typeSelect.onchange = function () {
        map.removeInteraction(draw);
        addInteraction();
        };

        document.getElementById('undo').addEventListener('click', function () {
        draw.removeLastPoint();
        });

/////////////////////////////////////////styles///////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////
        var markerStyle = new ol.style.Style({    
            image: new ol.style.Circle({
                radius: 7,
                fill: new ol.style.Fill({
                color: 'rgba(255,50, 255, 1)',
                }),
            }),
            stroke: new ol.style.Stroke({
            color: 'blue',
            width: 2,
            }),
        });

        var segStyle = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'red',
            width: 2,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(100,100, 100, 0.1)',
            }),
        });
        var segStyleHover = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'red',
            width: 4,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(255,100, 100, 0.3)',
            }),
        });

        var segStyleYellow = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'yellow',
            width: 2,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(100,100, 100, 0.1)',
            }),
        });
        var segStyleYellowHover = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'yellow',
            width: 4,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(255,100, 100, 0.3)',
            }),
        });

        var segStyleGreen = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'green',
            width: 2,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(100,100, 100, 0.1)',
            }),
        });
        var segStyleGreenHover = new ol.style.Style({    
            stroke: new ol.style.Stroke({
            color: 'green',
            width: 4,
            }),
            fill: new ol.style.Fill({
            color: 'rgba(255,100, 100, 0.3)',
            }),
        });

        var hideStyle =  new ol.style.Style({    
        
        });
/////////////////////////////////////////styles///////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////

        var sourceSeg = new ol.source.Vector({wrapX: false});
        var sourceMarker = new ol.source.Vector({wrapX: false});
        var sourceTracking = new ol.source.Vector({wrapX: false});
        var sourceTrackingLines = new ol.source.Vector({wrapX: false});

        var segLayer = new ol.layer.Vector({source: sourceSeg,style: segStyle,zIndex: 200});
        map.addLayer(segLayer);
        var markerLayer = new ol.layer.Vector({source: sourceMarker,style: markerStyle,zIndex: 201});
        map.addLayer(markerLayer);
        var trackingLayer = new ol.layer.Vector({source: sourceTracking,style: segStyle,zIndex: 200});
        map.addLayer(trackingLayer);
        var trackingLayer2 = new ol.layer.Vector({source: sourceTrackingLines,style: segStyle,zIndex: 201});
        map.addLayer(trackingLayer2);

        var segColl = new ol.Collection();
        var markerColl = new ol.Collection();
        var trackingColl = new ol.Collection();

        var snap = new ol.interaction.Snap({
            source: sourceSeg,
        });

        var seg;
        var marker;
        var point;
        var modify;

        function drawSegment(){
            removeInteractions();
            mouseState = 1;
            seg = new ol.interaction.Draw({
                type: 'Polygon',
                source: sourceSeg,
                features: segColl,
            });
            map.addInteraction(seg);
            map.addInteraction(snap);
        };

        function addMarker(){
            removeInteractions();
            mouseState = 3;
            marker = new ol.interaction.Draw({
                type: 'Point',
                source: sourceMarker,
                features: markerColl,
            });
            map.addInteraction(marker);
        };
        function editSegment(){
            removeInteractions ();
            mouseState = 2;
            modify = new ol.interaction.Modify({
                 features: segColl,
                 source: sourceSeg,
                 //hitDetection: true,
            });
            map.addInteraction(modify);
            //map.addInteraction(snap); 
        };
        function removeInteractions (){
            map.removeInteraction(seg);    
            map.removeInteraction(snap); 
            map.removeInteraction(modify);
            map.removeInteraction(marker);

            var glist = segColl.getArray();
            for (i = 0; i < glist.length; i++) {
                //console.log(glist[i].getId);
                if ((typeof glist[i].getId() != "string") && (typeof glist[i].getId() != "number")){
                    console.log('detget')
                    glist[i].setId(i);
                    glist[i].setStyle(segStyle);
                };
            };
            glist = markerColl.getArray();
            for (i = 0; i < glist.length; i++) {
                //console.log(glist[i].getId);
                if ((typeof glist[i].getId() != "string") && (typeof glist[i].getId() != "number")){
                    console.log('detget')
                    glist[i].setId(i);
                };
            };
            mouseState=0;
        };
        var selected = null;
        var status = document.getElementById('status');
        var highlightLayers = [segLayer];
        var tipBox = document.getElementById('toolTipBox');
        var hovering= false;

        function checkFeat (feat,hoverArray){
            if(hoverArray.includes(feat) && mouseState == 0){
                if (feat.getStyle()==segStyle || feat.getStyle()==segStyleHover ){
                    feat.setStyle(segStyleHover ); 
                }else if (feat.getStyle()==segStyleYellow || feat.getStyle()==segStyleYellowHover){
                    feat.setStyle(segStyleYellowHover ); 
                }else if (feat.getStyle()==segStyleGreen || feat.getStyle()==segStyleGreenHover){
                    feat.setStyle(segStyleGreenHover ); 
                };
                var polygon = feat.getGeometry();
                var ext = polygon.getExtent();
                var coords = ol.proj.toLonLat(ol.extent.getCenter(ext));
                tipBox.style.display = 'block';
                tipBox.innerHTML = feat.getId() + "<br />" + coords ;
                hovering = true;
            } else{
                if (feat.getStyle()==segStyle || feat.getStyle()==segStyleHover ){
                    feat.setStyle(segStyle); 
                }else if (feat.getStyle()==segStyleYellow || feat.getStyle()==segStyleYellowHover){
                    feat.setStyle(segStyleYellow); 
                }else if (feat.getStyle()==segStyleGreen || feat.getStyle()==segStyleGreenHover){
                    feat.setStyle(segStyleGreen); 
                };
            }; 
        };
        function checkMarker (feat,hoverArray){
            if(hoverArray.includes(feat) && mouseState == 0){
                var point = feat.getGeometry();
                var coords = point.getCoordinates();
                tipBox.style.display = 'block';
                tipBox.innerHTML =  feat.getId() + "<br />" + coords ;
                hovering = true;
            };
        };
        function checkFeatFocus (feat,hoverArray){
            if(hoverArray.includes(feat)){
                var polygon = feat.getGeometry();
                var size = map.getSize();
                var ext = polygon.getExtent();
                var coords = ol.extent.getCenter(ext);
               // console.log(coords);
                //console.log(size);
                view.setCenter(coords);
                view.fit(ext, {size: size, padding: [100, 100, 100, 100],});
                //console.log(feat);
                //console.log(feat.getId());
                currentSegmentID = feat.getId();
                showSegmentEditMenu();
            };
        };
        function checkMarkerClick (feat,hoverArray){
            if(hoverArray.includes(feat)){
                currentMarkerID = feat.getId();
                showMarkerEditMenu();
            };
        };
        //,layerFilter = (layerName => checkLayer(layerName))
        function onMouseHover(e){
            if (mouseState == 0){
                hovering = false;
                tipBox.innerHTML= '';
                var hoverArray = map.getFeaturesAtPixel([e.clientX,e.clientY]);
                //console.log(hoverArray);
                var segArray = segColl.getArray();
                segArray.forEach(feature => checkFeat(feature,hoverArray));
                var markerArray = markerColl.getArray();
                markerArray.forEach(feature => checkMarker(feature,hoverArray));
                tipBox.style.left= e.clientX ;
                tipBox.style.top= e.clientY - 40;
                if (hovering==false){tipBox.style.display = 'none'};
            };
        };
        function onClick(e) {
            //console.log(view.getCenter());
            if (e.button==2){
                mouseState = 0 ;
                removeInteractions();
            }else if(e.button==0  && mouseState == 0){
                removeInteractions();
                var hoverArray = map.getFeaturesAtPixel([e.clientX,e.clientY]);
                var markerArray = markerColl.getArray();
                markerArray.forEach(feature => checkMarkerClick(feature,hoverArray));
                if (document.getElementById("markerEditMenu").style.display=="none"){
                    var segArray = segColl.getArray();
                    segArray.forEach(feature => checkFeatFocus(feature,hoverArray));
                };
            };
        };

        //sourceSeg.on(ol.events.condition.click,console.log('event test'));

        document.getElementById("segName").addEventListener('change',updateSegName);

        function updateSegName(){
            console.log("listener test");
            var newValue = document.getElementById("segName").value;
            console.log(newValue);
            getFeatfromID(currentSegmentID);
            currentFeat.setId(newValue);
        };

        document.getElementById("markerName").addEventListener('change',updateMarkerName);

        function updateMarkerName(){
            console.log("listener test");
            var newValue = document.getElementById("markerName").value;
            console.log(newValue);
            getMarkerfromID(currentMarkerID);
            currentFeat.setId(newValue);
        };

        function deleteSeg(){
            getFeatfromID(currentSegmentID);
            sourceSeg.removeFeature(currentFeat);
            hideSegmentEditMenu();
        };
        function deleteMarker(){
            getMarkerfromID(currentMarkerID);
            sourceMarker.removeFeature(currentFeat);
            hideMarkerEditMenu();
        };

        function getFeatfromID(ID){
            var segArray = segColl.getArray();
            segArray.forEach(feature => getFeathelper(feature));
        };

        function getMarkerfromID(ID){
            var markerArray = markerColl.getArray();
            markerArray.forEach(feature => getMarkerhelper(feature));
        };
        function getFeathelper(feature){
            if(feature.getId()==currentSegmentID){currentFeat = feature};
        };
        function getMarkerhelper(feature){
            if(feature.getId()==currentMarkerID){currentFeat = feature};
        };
        function updateSegCol(newColour){
            getFeatfromID(currentSegmentID);
            if (newColour == "red"){
                currentFeat.setStyle(segStyle);
            }else if (newColour == "yellow"){
                currentFeat.setStyle(segStyleYellow);
            }else if (newColour == "green"){
                currentFeat.setStyle(segStyleGreen);
            };
        };

        function hideSat(){
            satLayer.setVisible(false)
            var ele = document.getElementById("Sat.");
            ele.classList.remove("buttonMapSatActive");
            var ele = document.getElementById("Map.");
            ele.classList.add("buttonMapSatActive");
        };
        function showSat(){
            satLayer.setVisible(true)
            var ele = document.getElementById("Sat.");
            ele.classList.add("buttonMapSatActive");
            var ele = document.getElementById("Map.");
            ele.classList.remove("buttonMapSatActive");
        };

        var names = [];
        var lats = [];
        var lons = [];
        var lines = [];
        function buildTrackSet(){
            names = [];
            lats = [];
            lons = [];
            lines = [];
            {% for point in trackPoints %}
                names.push("{{point.name}}");
                lats.push("{{point.Lat}}");
                lons.push("{{point.Lon}}");
            {% endfor %}
           
            console.log(tempLine);
            for (i = 0; i < names.length; i++) {
                var tempTrack = new ol.Feature( new ol.geom.Point(ol.proj.fromLonLat([lons[i],lats[i]])));
                //tempLine.appendCoordinate(ol.proj.fromLonLat([lons[i],lats[i]]));
                //temp = new ol.geom.Point(ol.proj.fromLonLat
                sourceTracking.addFeature(tempTrack);

                if (names.slice(0, (i-1)).includes(names[i])==false){
                    var tempLine = new ol.geom.LineString ([]);
                    var lineFeature =new ol.Feature(tempLine);
                    lineFeature.setId(names[i]);
                    lines.push(lineFeature);
                }else{
                    for (j = 0; j < lines.length; j++) {
                        if (lines[j].getId()==names[i]){
                            var tempLineGeom = lines[j].getGeometry();
                            tempLineGeom.appendCoordinate(ol.proj.fromLonLat([lons[i],lats[i]]));
                        };
                    }
                };

                
            }; 
            for (k = 0; k < lines.length; k++) {
                console.log(lines[k]);
                sourceTrackingLines.addFeature(lines[k]);
            };
        
        };

        ////// map zoom logger
        var zoomLevel = map.getView().getZoom();
        map.on('moveend', function(e) {
            zoomLevel = map.getView().getZoom();
            //console.log('zoom level');
           // console.log(zoomLevel);
           if (zoomLevel >= 15){
               trackingLayer2.setStyle(hideStyle);
               trackingLayer.setStyle(markerStyle);
           } else{
                trackingLayer.setStyle(hideStyle);     
                trackingLayer2.setStyle(markerStyle);
           };
        });
        hideSat();
        addInteraction();
        vectorLayerListener();
        toggleStreets();
        buildTrackSet();

        // grid segArray.forEach
        // leave notes about features
        // home buttond
</script>  

    {% load static %}
    <script src="http://code.jquery.com/jquery-1.11.0.js"></script>
    <script src="{% static 'js/script.js' %}"></script>
{% endblock %}

